# ReUntangle - 機能説明

## 概要
ReUntangleは、Reactプロジェクトの複雑さを可視化し、開発者がコードベースをより深く理解できるようにするツールです。

---

## 主要機能

### 1. 自動コンポーネント・フック検出

#### 機能説明
ローカルのReactプロジェクトフォルダを指定すると、自動的にすべてのReactコンポーネントとカスタムフックを検出します。

#### 対応ファイル
- `.jsx` - JavaScript + JSX
- `.tsx` - TypeScript + JSX
- `.js` - JavaScript（Reactコンポーネントを含む）
- `.ts` - TypeScript（Reactコンポーネントを含む）

#### 検出対象
- **Reactコンポーネント**: PascalCaseの関数・クラス（例: `MyComponent`）
- **カスタムフック**: `use`で始まる関数（例: `useMyHook`）⚡
- export文の解析
- JSX要素の存在確認

#### カスタムフック検出
カスタムフックは特別なアイコン⚡で表示され、以下を追跡します：
- どのコンポーネント・フックから呼び出されているか
- フック内で使用されている標準Hooks（useState, useEffect等）
- フックの複雑度（他のフックやロジックの量）

#### 除外されるもの
- `node_modules/`
- `.git/`
- `dist/`, `build/`
- その他の設定ファイル

---

### 2. 依存関係の解析

#### 機能説明
各コンポーネント・フックがどのコンポーネント・フックを使用しているか、どこから使用されているかを自動的に解析します。

#### 解析内容
- **import文の解析**: ES6 import構文を完全サポート
- **カスタムフック呼び出しの検出**: コンポーネント内の`useXxx()`呼び出しを自動検出
- **相対パス解決**: `../`, `./` などの相対パスを正確に解決
- **絶対パス解決**: エイリアスパス（`@/components/`など）をサポート
- **動的import**: `React.lazy()`や`import()`の検出
- **再エクスポート**: `export { Component } from './Component'` の追跡

#### 追跡される情報
- **親コンポーネント・フック**: このコンポーネント・フックを使用しているもの
- **子コンポーネント・フック**: このコンポーネント・フックが使用しているもの
- **カスタムフック依存**: コンポーネントが呼び出しているカスタムフック
- **依存の深さ**: ルートからの階層
- **依存の強さ**: 使用頻度
- **外部ライブラリの使用**: MUI、Antdなど

**外部ライブラリの扱い**:
- `@mui/material`、`antd`、`react-bootstrap`などの外部UIライブラリは、グラフには表示されません
- しかし、メトリクスには反映され、詳細パネルで確認できます
- これにより、プロジェクト内のコンポーネント構造に集中しつつ、外部依存の状況も把握できます

---

### 3. インタラクティブなグラフ可視化

#### ノード表現
各コンポーネント・フックがノード（円）として表示されます:

- **サイズ**: 複雑度に比例（40px〜100px）
  - 小: シンプル（複雑度 0-30）
  - 中: 標準（複雑度 31-60）
  - 大: 複雑（複雑度 61-100）

- **色**: 複雑度と状態により自動で色分け
  - 🔴 **赤** (`#ef4444`): 循環依存あり（最優先）
  - 🟣 **紫** (`#8b5cf6`): ルートコンポーネント（page.tsx, layout.tsx等）
  - ⚫ **グレー** (`#9ca3af`): 未使用コンポーネント
  - 🟢 **緑** (`#22c55e`): シンプル（複雑度 0-30）
  - 🔵 **青** (`#3b82f6`): 標準（複雑度 31-60）
  - 🟡 **黄** (`#eab308`): 複雑（複雑度 61-80）
  - 🟠 **オレンジ** (`#f97316`): 非常に複雑（複雑度 81-100）

- **ラベル**:
  - ノード内に複雑度スコア（数値）
  - ノード下にコンポーネント・フック名
  - カスタムフックには⚡アイコン付き

#### エッジ表現
コンポーネント間の関係が矢印で表示されます:

- **方向**: A → B は「AがBを使用」
- **太さ**: 依存の強さ
  - 細い: 弱い依存（1箇所のみ使用）
  - 太い: 強い依存（複数箇所で使用）
- **スタイル**:
  - 実線: 直接的な依存
  - 点線: 間接的な依存（将来対応）

#### インタラクション機能

**ズーム操作**
- マウスホイール: ズームイン/アウト
- ピンチ: タッチデバイスでのズーム
- ズームレベル: 10%〜500%

**パン操作**
- ドラッグ: 背景をドラッグして移動
- スムーズスクロール: 慣性付きの移動

**ノード操作**
- クリック: 詳細パネル表示
- ホバー: ツールチップ表示
- ドラッグ: ノード位置の調整
- ダブルクリック: フォーカス表示（中心に配置）

**選択機能**
- 単一選択: クリックで1つ選択
- 複数選択: Ctrl+クリックで追加選択（将来対応）
- 範囲選択: ドラッグで矩形選択（将来対応）

---

### 4. レイアウトアルゴリズム

#### ツリーレイアウト
階層構造を明確に表現するレイアウト:

- **特徴**:
  - 親子関係が明確
  - 依存の深さが視覚的にわかる
  - 整然とした配置
  
- **適している場面**:
  - コンポーネントツリーの全体像を把握したい
  - 階層構造を重視したい
  - プレゼンテーション用

#### 力学的レイアウト (Force-Directed)
物理シミュレーションによる自然な配置:

- **特徴**:
  - 関係性が近いノードが近くに配置
  - 有機的で理解しやすい
  - 循環依存が視覚的にわかる
  
- **適している場面**:
  - 複雑な依存関係を理解したい
  - クラスター（関連グループ）を発見したい
  - 実際の開発作業に使用

#### レイアウト切り替え
- ワンクリックで切り替え可能
- アニメーション付きの滑らかな遷移
- 現在の選択状態を維持

---

### 5. 複雑度分析

#### 複雑度スコア算出
各コンポーネントの複雑度を0〜100のスコアで評価:

**算出要素**:
- コード行数（25%）
- 依存コンポーネント数（20%）
- 被依存コンポーネント数（15%）
- Hooks使用数（20%）
- Props数（15%）
- 外部ライブラリ依存数（5%）

**スコアレンジ**:
- 0-30: 🟢 シンプル
- 31-60: 🟡 標準
- 61-80: 🟠 複雑
- 81-100: 🔴 非常に複雑

#### メトリクスダッシュボード
プロジェクト全体の統計情報を表示:

- 総コンポーネント数
- 平均複雑度
- 最も複雑なコンポーネントTOP 10
- 最も依存されているコンポーネント
- 循環依存の数

---

### 6. 警告と推奨事項

#### 循環依存の検出
A → B → C → A のような循環を自動検出:

- **表示**: 該当コンポーネントを赤でハイライト
- **詳細**: 循環パスを表示
- **推奨**: リファクタリングの提案

#### 未使用コンポーネントの特定
どこからも参照されていないコンポーネントを検出:

- **表示**: グレーで表示
- **推奨**: 削除またはドキュメント化の提案

#### 深い依存チェーンの警告
依存の深さが5階層以上のコンポーネントを警告:

- **表示**: 黄色でハイライト
- **影響**: 変更の影響範囲が広い
- **推奨**: 構造の平坦化

#### 高結合度の警告
特定のコンポーネントへの依存が10以上:

- **表示**: サイズを大きく表示
- **影響**: 変更リスクが高い
- **推奨**: 責任の分割

---

### 7. 詳細情報パネル

コンポーネントを選択すると、画面右側に詳細パネルが表示されます。

#### 基本情報セクション
- **コンポーネント名**: 正式な名前
- **ファイルパス**: フルパスとファイル名
- **コード行数**: LOC（Lines of Code）
- **最終更新日**: Git情報から取得（将来対応）

#### 依存関係セクション
- **依存リスト**: 使用している全コンポーネント
  - コンポーネント名
  - import文の行番号
  - 使用箇所の数
  
- **被依存リスト**: 使用されている全コンポーネント
  - 親コンポーネント名
  - 使用されている箇所

#### メトリクスセクション
- **複雑度スコア**: グラフ付き
- **依存の深さ**: 数値とビジュアル
- **Hooks**: 使用されているHooksの一覧
  - useState
  - useEffect
  - useContext
  - カスタムHooks

#### Props情報セクション（TypeScript限定）
- Props型定義
- 必須/オプショナルの区別
- デフォルト値

#### 外部ライブラリセクション
- 使用している外部UIライブラリ一覧
  - Material-UI (@mui/material)
  - Ant Design (antd)
  - React Bootstrap
  - その他のUIライブラリ
- 各ライブラリから使用しているコンポーネント数

---

### 8. 検索とフィルタリング

#### 高度な検索
- **コンポーネント名検索**: 部分一致対応
- **ファイルパス検索**: パスでの絞り込み
- **正規表現サポート**: 高度な検索パターン

#### フィルタリングオプション
- **階層レベル**: 特定の深さのみ表示
- **複雑度範囲**: スライダーで範囲指定
- **警告タイプ**: 特定の警告があるもののみ
- **使用状況**: 未使用、過剰使用など
- **ファイルタイプ**: .tsx/.jsxなどで絞り込み

#### ハイライト機能
- 検索結果を黄色でハイライト
- 関連コンポーネントを薄く表示
- フォーカスモード: 該当以外を透明化

---

### 9. データの保持と共有

#### ブラウザストレージ
- 最後に解析したプロジェクトを記憶
- レイアウト設定の保存
- フィルタ設定の保存

#### エクスポート機能（将来対応）
- **PNG画像**: プレゼンテーション用
- **SVG画像**: 編集可能なベクター形式
- **JSON**: データとして保存
- **レポートPDF**: 分析結果のレポート

---

### 10. パフォーマンス最適化

#### 高速処理
- **ワーカースレッド**: UIをブロックしない解析
- **遅延ロード**: 大規模プロジェクトの段階的読み込み
- **キャッシング**: 同じプロジェクトの再解析を高速化

#### 仮想レンダリング
- 表示範囲のノードのみレンダリング
- 1000コンポーネント以上でも滑らか

#### プログレス表示
- 解析進捗のリアルタイム表示
- 処理段階の明示
- キャンセル機能

---

## 技術的な特徴

### セキュリティ
- **完全クライアントサイド処理**: データを外部送信しない
- **プライバシー保護**: ユーザーデータを保存しない
- **安全なAPI使用**: File System Access API の適切な使用

### ブラウザ互換性
- **推奨**: Chrome, Edge（Chromium版）
- **サポート**: Firefox, Safari（一部機能制限あり）
- **最小要件**: ES2020対応ブラウザ

### アクセシビリティ
- キーボード操作対応
- スクリーンリーダー対応
- 高コントラストモード

---

## ユースケース

### 1. 新規メンバーのオンボーディング
プロジェクト構造を視覚的に理解できるため、新メンバーの学習コストを削減。

### 2. リファクタリング計画
複雑度の高い部分を特定し、優先順位を決めてリファクタリング。

### 3. コードレビュー
PRレビュー時に、変更がプロジェクト全体に与える影響を把握。

### 4. アーキテクチャ設計
理想的なコンポーネント構造との比較、設計の見直し。

### 5. 技術的負債の可視化
問題のある箇所を定量的に示し、改善の必要性を説明。

### 6. ドキュメント生成
自動生成された図をドキュメントに活用。

---

## 制限事項

### 現在サポートされていないもの
- プライベートリポジトリへの直接アクセス
- 動的に生成されるコンポーネント
- 高階コンポーネント(HOC)の完全な追跡
- Render Propsパターンの詳細解析

### パフォーマンス制限
- 推奨最大: 500コンポーネント
- 実用上限: 1000コンポーネント
- それ以上: フィルタリング必須

---

## ロードマップ

### 近日実装予定
- 画像エクスポート機能
- GitHubリポジトリ直接アクセス
- カスタムテーマ
- 比較モード（バージョン間の差分）

### 将来的な拡張
- Vue.js / Angular対応
- CI/CD統合
- チーム共有機能
- AIによる改善提案

---

## 実装済み機能（v1.0）

### ✅ コンポーネント・フック検出
- Reactコンポーネント（関数・クラス・アロー関数）の自動検出
- カスタムフック（use*）の自動検出と⚡アイコン表示
- TypeScript/JavaScript完全対応

### ✅ 依存関係の可視化
- インポートベースの依存関係
- カスタムフック呼び出しの検出
- コンポーネント→フック、フック→フックの依存関係

### ✅ 複雑度分析
- コード行数（25%）
- 依存関係数（20%）
- Hooks使用数（20%）
- Props数（15%）
- 外部ライブラリ数（5%）
- 基礎複雑度（20%）

### ✅ 視覚的な表現
- 複雑度に基づく色分け（7色）
- ルートコンポーネントの特別表示（紫）
- 循環依存の警告（赤）
- 未使用コンポーネントの検出（グレー）
- ノードサイズの動的調整

### ✅ インタラクティブ機能
- ノードクリックで詳細パネル表示
- TreeレイアウトとForceレイアウトの切り替え
- ズーム・パン操作
- ミニマップ

---

**最終更新日**: 2025年10月18日
**バージョン**: 1.0